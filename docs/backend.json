{
  "entities": {
    "CateringProvider": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CateringProvider",
      "type": "object",
      "description": "Represents a catering service provider.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the catering provider."
        },
        "name": {
          "type": "string",
          "description": "Name of the catering provider."
        },
        "phoneNumber": {
          "type": "string",
          "description": "Phone number of the catering provider."
        },
        "logoUrl": {
          "type": "string",
          "description": "URL of the catering provider's logo.",
          "format": "uri"
        },
        "serviceAreas": {
          "type": "array",
          "description": "Array of service areas covered by the catering provider.",
          "items": {
            "type": "string"
          }
        },
        "description": {
          "type": "string",
          "description": "Description of the catering provider's services."
        },
        "menuUrls": {
          "type": "array",
          "description": "Array of URLs to the catering provider's menus.",
          "items": {
            "type": "string"
          }
        },
        "photoGalleryUrls": {
          "type": "array",
          "description": "Array of URLs to the catering provider's photo gallery.",
          "items": {
            "type": "string"
          }
        },
        "averageRating": {
          "type": "number",
          "description": "Average rating of the catering provider."
        }
      },
      "required": [
        "id",
        "name",
        "phoneNumber",
        "logoUrl",
        "serviceAreas",
        "description",
        "menuUrls",
        "photoGalleryUrls",
        "averageRating"
      ]
    },
    "Review": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Review",
      "type": "object",
      "description": "Represents a review of a catering service provider.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the review."
        },
        "cateringProviderId": {
          "type": "string",
          "description": "Reference to CateringProvider. (Relationship: CateringProvider 1:N Review)"
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Review)"
        },
        "rating": {
          "type": "number",
          "description": "Rating given by the user (e.g., 1-5)."
        },
        "comment": {
          "type": "string",
          "description": "Comment associated with the review."
        },
        "date": {
          "type": "string",
          "description": "Date when the review was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "cateringProviderId",
        "userId",
        "rating",
        "comment",
        "date"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the application.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "Email address of the user.",
          "format": "email"
        },
        "firstName": {
          "type": "string",
          "description": "First name of the user."
        },
        "lastName": {
          "type": "string",
          "description": "Last name of the user."
        }
      },
      "required": [
        "id",
        "email",
        "firstName",
        "lastName"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "phone"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/cateringProviders/{cateringProviderId}",
        "definition": {
          "entityName": "CateringProvider",
          "schema": {
            "$ref": "#/backend/entities/CateringProvider"
          },
          "description": "Collection of catering service providers. Each document contains details like name, contact information, service areas, description, menus, photos and average rating.",
          "params": [
            {
              "name": "cateringProviderId",
              "description": "The unique identifier for the catering provider."
            }
          ]
        }
      },
      {
        "path": "/cateringProviders/{cateringProviderId}/reviews/{reviewId}",
        "definition": {
          "entityName": "Review",
          "schema": {
            "$ref": "#/backend/entities/Review"
          },
          "description": "Subcollection of reviews for each catering provider. Includes denormalized 'userId' for authorization independence.",
          "params": [
            {
              "name": "cateringProviderId",
              "description": "The unique identifier for the catering provider."
            },
            {
              "name": "reviewId",
              "description": "The unique identifier for the review."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Collection of user profiles.  Each document contains the user's id, email, first name, and last name.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore structure is designed to ensure security, scalability, and debuggability, adhering to the principles of Authorization Independence, Clarity of Intent, DBAC, and QAPs. \n\n1.  **Catering Providers:** Catering provider data is stored in a top-level `/cateringProviders` collection. This facilitates easy listing and searching of providers.\n\n2.  **User Data:** User profiles are stored under the `/users/{userId}` path. This ensures that user data is private and accessible only to the user themselves, unless explicitly shared.\n\n3.  **Reviews:** Reviews are stored in a subcollection `/cateringProviders/{cateringProviderId}/reviews`. The `cateringProviderId` and `userId` are stored within each review document, linking the review to both the catering provider and the user who created it. While this creates a subcollection, authorization independence is maintained because rules can validate `request.auth.uid` against the `userId` field in the review and rules can validate the reviewed `cateringProviderId`.\n\n**Authorization Independence:**\nTo ensure Authorization Independence (CRITICAL), the structure avoids `get()` calls in security rules.  Specifically, for reviews, the `userId` is denormalized into the review document itself. This allows security rules to validate that the user creating/modifying the review is indeed the owner, without needing to `get()` the user document.  Similarly, the `cateringProviderId` is present so rules can apply at the `/cateringProviders/{cateringProviderId}/reviews/{reviewId}` level.\n\n**QAPs (Rules are not Filters):**\nThe structure supports secure `list` operations by segregating data based on access needs. Listing all catering providers is a common use case, which is readily supported. Reviews are scoped under catering providers, preventing the need to filter across all reviews in the database. Security rules can efficiently check the existence or attributes of parent documents, if necessary, without complex queries. All documents in a collection share the same security requirements, complying with structural segregation best practices."
  }
}